(window.webpackJsonp=window.webpackJsonp||[]).push([[15],{311:function(t,e,n){"use strict";n.r(e);var o=n(3),i=n.n(o),a=n(10),r=n(22),s=n(4),c=n(5),l=n(8),u=n(7),h=n(9),v=n(2),d=n(6),m=function(t){function e(t){var n,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Object(s.a)(this,e),n=Object(l.a)(this,Object(u.a)(e).call(this,t,Object(r.a)({},o,{commandId:"Translate"}))),Object(d.a)(Object(v.a)(Object(v.a)(n)),"onCameraChanged",function(){n.TxControl&&n.TxControl.update()}),Object(d.a)(Object(v.a)(Object(v.a)(n)),"onButtonDown",function(t){if(n.dragging=!0,n.pointerDown=n.TxControl.onPointerDown(t),n.pointerDown&&n.selection)return!0;var e=n.viewer.clientToWorld(t.canvasX,t.canvasY,!0);return e&&n.hitPoint.copy(e.intersectPoint),!1}),Object(d.a)(Object(v.a)(Object(v.a)(n)),"onButtonUp",function(t){return n.dragging=!1,!!n.TxControl.onPointerUp(t)}),Object(d.a)(Object(v.a)(Object(v.a)(n)),"onMouseMove",function(t){var e=n.dragging?n.TxControl.onPointerMove(t):n.TxControl.onPointerHover(t);return e&&n.viewer.impl.sceneUpdated(!0),e}),Object(d.a)(Object(v.a)(Object(v.a)(n)),"onKeyDown",function(t,e){return 27===e&&n.deactivate(),!1}),Object(d.a)(Object(v.a)(Object(v.a)(n)),"onTxChange",function(){if(n.dragging&&n.TxControl.visible){var t=n.selection.model,e=n.TxMesh.position,o=new THREE.Vector3(e.x-t.offset.x,e.y-t.offset.y,e.z-t.offset.z),i=n.selectedFragments.map(function(t){return t.position=new THREE.Vector3(e.x-t.offset.x,e.y-t.offset.y,e.z-t.offset.z),t.updateAnimTransform(),t.fragId});n.viewer.impl.sceneUpdated(!0),n.emit("transform",{transform:{translation:o},fragIds:i,model:t})}}),n.commandTool.on("buttondown",n.onButtonDown),n.commandTool.on("mousemove",n.onMouseMove),n.commandTool.on("buttonup",n.onButtonUp),n.commandTool.on("keydown",n.onKeyDown),n.fullTransform=o.fullTransform,n.hitPoint=new THREE.Vector3,n.selectedFragments=[],n.selection=null,n.dragging=null,n}return Object(h.a)(e,t),Object(c.a)(e,[{key:"createTransformMesh",value:function(){var t=new THREE.Mesh(new THREE.SphereGeometry(1e-4,5));return t.position.set(0,0,0),t}},{key:"onActivate",value:function(){var t=this.viewer.model.getBoundingBox();this.viewer.impl.createOverlayScene("TranslateToolOverlay"),this.TxControl=new THREE.TransformControls(this.viewer.impl.camera,this.viewer.impl.canvas,"translate"),this.TxControl.setSize(5*t.getBoundingSphere().radius),this.TxControl.visible=!1,this.viewer.impl.addOverlay("TranslateToolOverlay",this.TxControl),this.TxMesh=this.createTransformMesh(),this.TxControl.attach(this.TxMesh)}},{key:"onDeactivate",value:function(){this.clearSelection()}},{key:"setSelection",value:function(){var t=Object(a.a)(i.a.mark(function t(e){var n,o,a,r,s=this;return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e.selections.length){t.next=2;break}return t.abrupt("return",this.clearSelection());case 2:if(this.selection=e.selections[0],this.selectedFragments=[],n=this.selection.model,o=n.transform||{translation:{x:0,y:0,z:0}},n.offset={x:this.hitPoint.x-o.translation.x,y:this.hitPoint.y-o.translation.y,z:this.hitPoint.z-o.translation.z},this.TxControl.visible=!0,this.TxControl.setPosition(this.hitPoint),this.TxControl.addEventListener("change",this.onTxChange),this.viewer.addEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,this.onCameraChanged),this.fullTransform&&(a=n.getData().instanceTree,this.selection.fragIdsArray=[],this.selection.dbIdArray=[a.getRootId()]),this.selection.fragIdsArray.length){t.next=18;break}return t.next=15,getFragIds(n,this.selection.dbIdArray);case 15:t.t0=t.sent,t.next=19;break;case 18:t.t0=this.selection.fragIdsArray;case 19:r=t.t0,this.selectedFragments=r.map(function(t){var e=s.viewer.impl.getFragmentProxy(n,t);return e.getAnimTransform(),e.offset={x:s.hitPoint.x-e.position.x,y:s.hitPoint.y-e.position.y,z:s.hitPoint.z-e.position.z},e}),this.viewer.impl.sceneUpdated(!0);case 22:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}()},{key:"clearSelection",value:function(){this.viewer.removeEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,this.onCameraChanged),this.TxControl&&(this.TxControl.removeEventListener("change",this.onTxChange),this.TxControl.visible=!1,this.selectedFragments=[],this.viewer.impl.sceneUpdated(!0)),this.selection=null,this.emit("selection",null),this.viewer.clearSelection()}},{key:"pickPosition",value:function(){}},{key:"setFullTransform",value:function(t){this.fullTransform=t,this.clearSelection()}}]),e}(n(343).a);e.default=m},343:function(t,e,n){"use strict";var o=n(4),i=n(5),a=n(8),r=n(7),s=n(9),c=n(2),l=n(30),u=function(t){function e(t){var n,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Object(o.a)(this,e),(n=Object(a.a)(this,Object(r.a)(e).call(this))).toolName=i.commandId,t.toolController.registerTool(Object(c.a)(Object(c.a)(n))),n.options=i,n.viewer=t,n}return Object(s.a)(e,t),Object(i.a)(e,[{key:"getNames",value:function(){return[this.toolName]}},{key:"getName",value:function(){return this.toolName}},{key:"activate",value:function(){this.active||(this.active=!0,this.viewer.toolController.activateTool(this.toolName),this.emit("activate",this))}},{key:"deactivate",value:function(){this.active&&(this.active=!1,this.viewer.toolController.deactivateTool(this.toolName),this.emit("deactivate",this))}},{key:"unregister",value:function(){this.deactivate(),this.off(),this.viewer.toolController.deregisterTool(this)}},{key:"handleSingleClick",value:function(t,e){return this.emit("singleclick",t,e)}},{key:"handleMouseMove",value:function(t){return this.emit("mousemove",t)}},{key:"handleKeyDown",value:function(t,e){return this.emit("keydown",t,e)}},{key:"handleKeyUp",value:function(t,e){return this.emit("keyup",t,e)}},{key:"handleButtonDown",value:function(t,e){return this.emit("buttondown",t,e)}},{key:"handleButtonUp",value:function(t,e){return this.emit("buttonup",t,e)}}]),e}(l.a),h=function(t){function e(t){var n,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Object(o.a)(this,e),(n=Object(a.a)(this,Object(r.a)(e).call(this))).commandTool=new u(t,i),n.commandTool.on("activate",function(t){n.emit("command.activate",Object(c.a)(Object(c.a)(n)))}),n.commandTool.on("deactivate",function(t){n.emit("command.deactivate",Object(c.a)(Object(c.a)(n)))}),n.commandId=i.commandId,n.options=i,n.viewer=t,n}return Object(s.a)(e,t),Object(i.a)(e,[{key:"activate",value:function(){this.commandTool.active||(this.commandTool.activate(),this.onActivate())}},{key:"onActivate",value:function(){}},{key:"deactivate",value:function(){this.commandTool.active&&(this.commandTool.deactivate(),this.onDeactivate())}},{key:"onDeactivate",value:function(){}},{key:"terminate",value:function(){this.control&&this.options.parentControl.removeControl(this.control),this.commandTool.unregister(),this.off()}},{key:"toggle",value:function(){this.active?this.deactivate():this.activate()}},{key:"createButton",value:function(t,e,n,o){var i=new Autodesk.Viewing.UI.Button(t);return i.icon.style.fontSize="24px",i.icon.className=e,i.setToolTip(n),i.onClick=o,i}},{key:"createButtonControl",value:function(t){var e=this.createButton(t.id,t.icon,t.caption,t.handler),n=t.parentControl;if(!n){var o=this.viewer.getToolbar(!0);n=new Autodesk.Viewing.UI.ControlGroup(t.id),o.addControl(n)}return n.addControl(e),e}},{key:"active",get:function(){return this.commandTool.active}}]),e}(l.a);e.a=h}}]);
//# sourceMappingURL=15.74b68d37.chunk.js.map