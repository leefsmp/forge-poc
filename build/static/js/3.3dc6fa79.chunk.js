(window.webpackJsonp=window.webpackJsonp||[]).push([[3],{313:function(e,t,i){"use strict";i.r(t);var n=i(3),o=i.n(n),r=i(10),a=i(22),s=i(4),c=i(5),l=i(8),h=i(7),u=i(9),v=i(2),m=i(6),d=function(e){function t(e,i,n){var o;Object(s.a)(this,t),(o=Object(l.a)(this,Object(h.a)(t).call(this))).engaged=!1,o.overlayScene="rotateControlScene",o.domElement=e.impl.canvas,o.camera=e.impl.camera,o.viewer=e,o.center=i,o.size=n,o.gizmos=[],o.viewer.impl.createOverlayScene(o.overlayScene),o.createAxis(i,new THREE.Vector3(1,0,0),.85*n,16711680),o.createAxis(i,new THREE.Vector3(0,1,0),.85*n,65280),o.createAxis(i,new THREE.Vector3(0,0,1),.85*n,255),o.camera.worldup.y?(o.gizmos.push(o.createGizmo(i,new THREE.Euler(0,Math.PI/2,0),.0045*n,.8*n,16711680,Math.PI,new THREE.Vector3(1,0,0))),o.gizmos.push(o.createGizmo(i,new THREE.Euler(Math.PI/2,0,0),.0045*n,.8*n,65280,2*Math.PI,new THREE.Vector3(0,1,0))),o.gizmos.push(o.createGizmo(i,new THREE.Euler(0,0,0),.0045*n,.8*n,255,Math.PI,new THREE.Vector3(0,0,1)))):(o.gizmos.push(o.createGizmo(i,new THREE.Euler(Math.PI/2,Math.PI/2,0),.0045*n,.8*n,16711680,Math.PI,new THREE.Vector3(1,0,0))),o.gizmos.push(o.createGizmo(i,new THREE.Euler(Math.PI/2,0,0),.0045*n,.8*n,65280,Math.PI,new THREE.Vector3(0,1,0))),o.gizmos.push(o.createGizmo(i,new THREE.Euler(0,0,0),.0045*n,.8*n,255,2*Math.PI,new THREE.Vector3(0,0,1)))),o.picker=o.createSphere(.02*n);var r=new THREE.LineBasicMaterial({color:16776960,linewidth:1,depthTest:!1,depthWrite:!1,transparent:!0});return o.angleLine=o.createLine(o.center,o.center,r),e.impl.sceneUpdated(!0),o}return Object(u.a)(t,e),Object(c.a)(t,[{key:"createLine",value:function(e,t,i){var n=new THREE.Geometry;n.vertices.push(new THREE.Vector3(e.x,e.y,e.z)),n.vertices.push(new THREE.Vector3(t.x,t.y,t.z));var o=new THREE.Line(n,i);return this.viewer.impl.addOverlay(this.overlayScene,o),o}},{key:"createCone",value:function(e,t,i,n){t.normalize();var o={x:e.x+t.x*i,y:e.y+t.y*i,z:e.z+t.z*i},r=new THREE.Matrix4;r.lookAt(e,o,(new THREE.Object3D).up);var a=new THREE.Matrix4;a.set(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1),r.multiply(a);var s=new THREE.CylinderGeometry(0,.2*i,i,128,1),c=new THREE.Mesh(s,n);return c.applyMatrix(r),c.position.x=e.x+t.x*i/2,c.position.y=e.y+t.y*i/2,c.position.z=e.z+t.z*i/2,this.viewer.impl.addOverlay(this.overlayScene,c),c}},{key:"createAxis",value:function(e,t,i,n){var o={x:e.x+t.x*i,y:e.y+t.y*i,z:e.z+t.z*i},r=new THREE.LineBasicMaterial({color:n,linewidth:3,depthTest:!1,depthWrite:!1,transparent:!0});this.createLine(e,o,r),this.createCone(o,t,.1*i,r)}},{key:"createGizmo",value:function(e,t,i,n,o,r,a){var s=new p({color:o}),c=new p({color:o}),l=new THREE.Mesh(new THREE.TorusGeometry(n,i,64,64,r),s),h=new THREE.Mesh(new THREE.TorusGeometry(n,i,64,64,2*Math.PI),c);h.material.highlight(!0);var u=new THREE.Matrix4,v=new THREE.Quaternion;v.setFromEuler(t);var m=new THREE.Vector3(1,1,1);u.compose(e,v,m),l.applyMatrix(u),h.applyMatrix(u);var d=this.createBox(100*this.size,100*this.size,.01);return d.applyMatrix(u),h.visible=!1,this.viewer.impl.addOverlay(this.overlayScene,l),this.viewer.impl.addOverlay(this.overlayScene,h),l.subGizmo=h,l.plane=d,l.axis=a,l}},{key:"createBox",value:function(e,t,i){var n=new p({color:0}),o=new THREE.BoxGeometry(e,t,i),r=new THREE.Mesh(o,n);return r.visible=!1,this.viewer.impl.addOverlay(this.overlayScene,r),r}},{key:"createSphere",value:function(e){var t=new p({color:16776960}),i=new THREE.SphereGeometry(e,32,32),n=new THREE.Mesh(i,t);return n.visible=!1,this.viewer.impl.addOverlay(this.overlayScene,n),n}},{key:"pointerToRaycaster",value:function(e){var t=new THREE.Vector3,i=new THREE.Vector3,n=new THREE.Raycaster,o=this.domElement.getBoundingClientRect(),r=(e.clientX-o.left)/o.width*2-1,a=-(e.clientY-o.top)/o.height*2+1;return this.camera.isPerspective?(t.set(r,a,.5),t.unproject(this.camera),n.set(this.camera.position,t.sub(this.camera.position).normalize())):(t.set(r,a,-1),t.unproject(this.camera),i.set(0,0,-1),n.set(t,i.transformDirection(this.camera.matrixWorld))),n}},{key:"onPointerDown",value:function(e){var t=e.pointers?e.pointers[0]:e;if(0===t.button){var i=this.pointerToRaycaster(t).intersectObjects(this.gizmos,!0);i.length?(this.gizmos.forEach(function(e){e.visible=!1}),this.selectedGizmo=i[0].object,this.selectedGizmo.subGizmo.visible=!0,this.picker.position.copy(i[0].point),this.angleLine.geometry.vertices[1].copy(i[0].point),this.lastDir=i[0].point.sub(this.center).normalize(),this.angleLine.geometry.verticesNeedUpdate=!0,this.angleLine.visible=!0,this.picker.visible=!0):this.picker.visible=!1,this.engaged=this.picker.visible,this.viewer.impl.sceneUpdated(!0)}return this.picker.visible}},{key:"onPointerHover",value:function(e){var t=e.pointers?e.pointers[0]:e;if(this.engaged){if((a=this.pointerToRaycaster(t).intersectObjects([this.selectedGizmo.plane],!0)).length){var i=a[0].point.sub(this.center).normalize(),n=new THREE.Vector3;n.crossVectors(this.lastDir,i);var o=Math.sign(n.dot(this.selectedGizmo.axis));this.emit("rotate",{angle:o*i.angleTo(this.lastDir),axis:this.selectedGizmo.axis}),this.lastDir=i;var r=new THREE.Vector3(this.center.x+i.x*this.size*.8,this.center.y+i.y*this.size*.8,this.center.z+i.z*this.size*.8);this.picker.position.copy(r),this.angleLine.geometry.vertices[1].copy(r)}this.angleLine.visible=!0,this.angleLine.geometry.verticesNeedUpdate=!0}else{var a;this.angleLine.visible=!1,(a=this.pointerToRaycaster(t).intersectObjects(this.gizmos,!0)).length?(this.picker.position.set(a[0].point.x,a[0].point.y,a[0].point.z),this.picker.visible=!0):this.picker.visible=!1}this.viewer.impl.sceneUpdated(!0)}},{key:"onPointerUp",value:function(e){var t=this;this.angleLine.visible=!1,this.picker.visible=!1,this.gizmos.forEach(function(e){e.visible=!0,e.subGizmo.visible=!1}),this.viewer.impl.sceneUpdated(!0),setTimeout(function(){t.engaged=!1},100)}},{key:"normalize",value:function(e){var t=this.viewer.navigation.getScreenViewport();return{x:(e.x-t.left)/t.width,y:(e.y-t.top)/t.height}}},{key:"projectOntoPlane",value:function(e,t){var i=t.dot(e);return new THREE.Vector3(e.x-i*t.x,e.y-i*t.y,e.z-i*t.z)}},{key:"remove",value:function(){this.viewer.impl.removeOverlayScene(this.overlayScene)}}]),t}(i(30).a),p=function(e){function t(e){var i;return Object(s.a)(this,t),(i=Object(l.a)(this,Object(h.a)(t).call(this))).setValues(e),i.colorInit=i.color.clone(),i.opacityInit=i.opacity,i.side=THREE.FrontSide,i.depthWrite=!1,i.transparent=!0,i.depthTest=!1,i}return Object(u.a)(t,e),Object(c.a)(t,[{key:"highlight",value:function(e){e?(this.color.setRGB(1,230/255,3/255),this.opacity=1):(this.color.copy(this.colorInit),this.opacity=this.opacityInit)}}]),t}(THREE.MeshBasicMaterial),y=i(345),E=i(41),w=function(e){function t(e){var i,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Object(s.a)(this,t),i=Object(l.a)(this,Object(h.a)(t).call(this,e,Object(a.a)({},n,{commandId:"Rotate"}))),Object(m.a)(Object(v.a)(Object(v.a)(i)),"onButtonDown",function(e,t){return!(!i.rotateControl||!i.rotateControl.onPointerDown(e))||!(0!==t||!i.keys.Control)&&(i.dragging=!0,i.mousePos={x:e.clientX,y:e.clientY},!0)}),Object(m.a)(Object(v.a)(Object(v.a)(i)),"onButtonUp",function(e,t){return i.rotateControl&&i.rotateControl.onPointerUp(e),0===t&&(i.dragging=!1),!1}),Object(m.a)(Object(v.a)(Object(v.a)(i)),"onMouseMove",function(e){if(i.rotateControl&&i.rotateControl.onPointerHover(e),i.dragging){if(i.selection){var t={x:i.mousePos.x-e.clientX,y:e.clientY-i.mousePos.y};i.mousePos={x:e.clientX,y:e.clientY};var n=Math.sqrt(t.x*t.x+t.y*t.y),o=new THREE.Vector3,r=new THREE.Vector3,a=new THREE.Vector3,s=new THREE.Vector3,c=i.viewer.getCamera(),l=new THREE.Vector3,h=new THREE.Vector3;h.copy(c.position).sub(c.target),a.copy(h).normalize(),s.copy(c.up).normalize(),o.crossVectors(s,a).normalize(),s.setLength(t.y),o.setLength(t.x),r.copy(s.add(o)),l.crossVectors(r,h).normalize(),i.rotateFragments(i.selection.model,i.selection.fragIdsArray,l,n*Math.PI/180,i.center),i.viewer.impl.sceneUpdated(!0)}return!0}return!1}),Object(m.a)(Object(v.a)(Object(v.a)(i)),"onKeyDown",function(e,t){return i.keys[e.key]=!0,27===t&&i.deactivate(),!1}),Object(m.a)(Object(v.a)(Object(v.a)(i)),"onKeyUp",function(e){return i.keys[e.key]=!1,!1}),i.commandTool.on("buttondown",i.onButtonDown),i.commandTool.on("mousemove",i.onMouseMove),i.commandTool.on("buttonup",i.onButtonUp),i.commandTool.on("keydown",i.onKeyDown),i.commandTool.on("keyup",i.onKeyUp),i.fullTransform=n.fullTransform,i.keys={},i}return Object(u.a)(t,e),Object(c.a)(t,[{key:"onDeactivate",value:function(){this.clearSelection()}},{key:"setFullTransform",value:function(e){this.fullTransform=e,this.clearSelection()}},{key:"setSelection",value:function(e){if(this.rotateControl&&this.rotateControl.engaged)return this.rotateControl.engaged=!1,void this.viewer.select(this.selection.dbIdArray);if(!e.selections.length)return this.clearSelection();this.selection=e.selections[0];var t=this.selection.model;if(this.fullTransform){this.selection.fragIdsArray=[];for(var i=t.getFragmentList().fragments.fragId2dbId.length,n=0;n<i;++n)this.selection.fragIdsArray.push(n);var o=t.getData().instanceTree;this.selection.dbIdArray=[o.getRootId()]}this.drawControl(),this.viewer.fitToView(this.selection.dbIdArray),this.emit("selection",this.selection)}},{key:"clearSelection",value:function(){this.selection=null,this.rotateControl&&(this.rotateControl.remove(),this.rotateControl=null,this.viewer.impl.sceneUpdated(!0)),this.emit("selection",null),this.viewer.clearSelection()}},{key:"drawControl",value:function(){var e=Object(r.a)(o.a.mark(function e(){var t,i,n=this;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(E.e)(this.selection.model,this.selection.dbIdArray);case 2:t=e.sent,this.center=new THREE.Vector3((t.min.x+t.max.x)/2,(t.min.y+t.max.y)/2,(t.min.z+t.max.z)/2),i=.8*Math.max(t.max.x-t.min.x,t.max.y-t.min.y,t.max.z-t.min.z),this.rotateControl&&this.rotateControl.remove(),this.rotateControl=new d(this.viewer,this.center,i),this.rotateControl.on("rotate",function(e){n.rotateFragments(n.selection.model,n.selection.fragIdsArray,e.axis,e.angle,n.center),n.viewer.impl.sceneUpdated(!0)});case 8:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"rotateFragments",value:function(e,t,i,n,o){var r=this,a=new THREE.Quaternion;a.setFromAxisAngle(i,n),t.forEach(function(i,n){var s=r.viewer.impl.getFragmentProxy(e,i);s.getAnimTransform();var c=new THREE.Vector3(s.position.x-o.x,s.position.y-o.y,s.position.z-o.z);if(c.applyQuaternion(a),c.add(o),s.position=c,s.quaternion.multiplyQuaternions(a,s.quaternion),0===n){var l=new THREE.Euler;l.setFromQuaternion(s.quaternion,0),r.emit("transform",{dbIds:r.selection.dbIdArray,transform:{rotation:l},fragIds:t,model:e})}s.updateAnimTransform()})}}]),t}(y.a);t.default=w},345:function(e,t,i){"use strict";var n=i(4),o=i(5),r=i(8),a=i(7),s=i(9),c=i(2),l=i(30),h=function(e){function t(e){var i,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Object(n.a)(this,t),(i=Object(r.a)(this,Object(a.a)(t).call(this))).toolName=o.commandId,e.toolController.registerTool(Object(c.a)(Object(c.a)(i))),i.options=o,i.viewer=e,i}return Object(s.a)(t,e),Object(o.a)(t,[{key:"getNames",value:function(){return[this.toolName]}},{key:"getName",value:function(){return this.toolName}},{key:"activate",value:function(){this.active||(this.active=!0,this.viewer.toolController.activateTool(this.toolName),this.emit("activate",this))}},{key:"deactivate",value:function(){this.active&&(this.active=!1,this.viewer.toolController.deactivateTool(this.toolName),this.emit("deactivate",this))}},{key:"unregister",value:function(){this.deactivate(),this.off(),this.viewer.toolController.deregisterTool(this)}},{key:"handleSingleClick",value:function(e,t){return this.emit("singleclick",e,t)}},{key:"handleMouseMove",value:function(e){return this.emit("mousemove",e)}},{key:"handleKeyDown",value:function(e,t){return this.emit("keydown",e,t)}},{key:"handleKeyUp",value:function(e,t){return this.emit("keyup",e,t)}},{key:"handleButtonDown",value:function(e,t){return this.emit("buttondown",e,t)}},{key:"handleButtonUp",value:function(e,t){return this.emit("buttonup",e,t)}}]),t}(l.a),u=function(e){function t(e){var i,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Object(n.a)(this,t),(i=Object(r.a)(this,Object(a.a)(t).call(this))).commandTool=new h(e,o),i.commandTool.on("activate",function(e){i.emit("command.activate",Object(c.a)(Object(c.a)(i)))}),i.commandTool.on("deactivate",function(e){i.emit("command.deactivate",Object(c.a)(Object(c.a)(i)))}),i.commandId=o.commandId,i.options=o,i.viewer=e,i}return Object(s.a)(t,e),Object(o.a)(t,[{key:"activate",value:function(){this.commandTool.active||(this.commandTool.activate(),this.onActivate())}},{key:"onActivate",value:function(){}},{key:"deactivate",value:function(){this.commandTool.active&&(this.commandTool.deactivate(),this.onDeactivate())}},{key:"onDeactivate",value:function(){}},{key:"terminate",value:function(){this.control&&this.options.parentControl.removeControl(this.control),this.commandTool.unregister(),this.off()}},{key:"toggle",value:function(){this.active?this.deactivate():this.activate()}},{key:"createButton",value:function(e,t,i,n){var o=new Autodesk.Viewing.UI.Button(e);return o.icon.style.fontSize="24px",o.icon.className=t,o.setToolTip(i),o.onClick=n,o}},{key:"createButtonControl",value:function(e){var t=this.createButton(e.id,e.icon,e.caption,e.handler),i=e.parentControl;if(!i){var n=this.viewer.getToolbar(!0);i=new Autodesk.Viewing.UI.ControlGroup(e.id),n.addControl(i)}return i.addControl(t),t}},{key:"active",get:function(){return this.commandTool.active}}]),t}(l.a);t.a=u}}]);
//# sourceMappingURL=3.3dc6fa79.chunk.js.map